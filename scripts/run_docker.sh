#!/usr/bin/env bash

set -e  # останавливаемся при любой ошибке

# -----------------------------------------------------------------------------
# Конфигурация
# -----------------------------------------------------------------------------

IMAGE_NAME="mvpipeline:latest"
CONTAINER_WORKDIR="/app"

echo "=== Запуск MVPipeline в Docker ==="
echo "Image: ${IMAGE_NAME}"
echo "Workdir: ${CONTAINER_WORKDIR}"
echo ""

# -----------------------------------------------------------------------------
# Проверка: существует ли docker образ
# -----------------------------------------------------------------------------

if [[ -z "$(docker images -q ${IMAGE_NAME} 2> /dev/null)" ]]; then
  echo "Docker образ ${IMAGE_NAME} не найден."
  echo "Сначала соберите образ:"
  echo "    docker build -t mvpipeline:latest ."
  exit 1
fi

# -----------------------------------------------------------------------------
# Запуск контейнера
# -----------------------------------------------------------------------------
# -v "$PWD:/app" → монтируем текущий проект внутрь контейнера
# --rm → контейнер удалится после завершения
# -it → интерактивный режим (красивые логи, rich, tqdm)
# -----------------------------------------------------------------------------

docker run --rm -it \
  -v "$PWD:${CONTAINER_WORKDIR}" \
  -w "${CONTAINER_WORKDIR}" \
  ${IMAGE_NAME} \
  bash scripts/run_validation.sh

echo ""
echo "=== Docker run завершён ==="
