from __future__ import annotations
from pymatgen.core import Structure


def sanity_ok(struct: Structure) -> bool:
    """
    Выполняет базовую sanity-проверку структуры после чтения CIF.

    Это самый первый и быстрый уровень проверки, цель которого — отсеять
    очевидно повреждённые или некорректные структуры до выполнения более
    дорогих операций (symmetry, geometry, chemistry и т.д.).

    Проверяемые условия:

    1. Структура должна содержать хотя бы один атом.
       Пустая структура означает ошибку генерации или повреждённый CIF.

    2. Объём структуры должен быть положительным.
       Нулевой или отрицательный объём означает некорректную решётку,
       что делает невозможными дальнейшие физические проверки.

    Эти проверки быстрые (O(1)) и предотвращают ошибки в последующих этапах
    pipeline, таких как:
        - вычисление distance_matrix,
        - определение spacegroup,
        - вычисление density,
        - дедупликация.

    Parameters
    ----------
    struct : Structure
        Объект pymatgen Structure, полученный из CIF.

    Returns
    -------
    bool
        True  → структура прошла sanity-проверку
        False → структура повреждена или некорректна
    """

    # структура должна содержать хотя бы один атом
    if len(struct) <= 0:
        return False

    # объём должен быть положительным
    # volume == 0 или None означает некорректную решётку
    if not (struct.volume and struct.volume > 0):
        return False

    return True
