# MVPipeline ‚Äî Crystal Structure Validation Pipeline

[![Python 3.x](https://img.shields.io/badge/python-3.x-blue.svg)](https://www.python.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## –û –ø—Ä–æ–µ–∫—Ç–µ

**MVPipeline** ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ CIF, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏: MatterGen, Con-CDVAE, CrystalFormer –∏ –¥—Ä—É–≥–∏–º–∏.

–ì–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ CIF-—Ñ–∞–π–ª–æ–≤, –æ–¥–Ω–∞–∫–æ —Å—Ä–µ–¥–∏ –Ω–∏—Ö —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è:

- **–ë–∏—Ç—ã–µ —Ñ–∞–π–ª—ã** ‚Äî CIF –Ω–µ –ø–æ–¥–¥–∞—ë—Ç—Å—è –ø–∞—Ä—Å–∏–Ω–≥—É
- **–§–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî –∞—Ç–æ–º—ã –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –∏–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- **–•–∏–º–∏—á–µ—Å–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî –∑–∞—Ä—è–¥ –Ω–µ —Å—Ö–æ–¥–∏—Ç—Å—è
- **–î—É–±–ª–∏–∫–∞—Ç—ã** ‚Äî –º–æ–¥–µ–ª—å —à—Ç–∞–º–ø—É–µ—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ
- **–ù–µ–Ω–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ train-–Ω–∞–±–æ—Ä–µ

MVPipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç –≤–µ—Å—å –Ω–∞–±–æ—Ä CIF —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π pipeline, –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ—Ç –º—É—Å–æ—Ä –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –û–¥–∏–Ω –∑–∞–ø—É—Å–∫ ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç.

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

```
outputs/my_model/
‚îú‚îÄ‚îÄ validation_report.json     # –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
‚îú‚îÄ‚îÄ all_structures.csv         # –ü–æ–ª–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –ø–æ –≤—Å–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º
‚îú‚îÄ‚îÄ validated_structures/      # –°—Ç—Ä—É–∫—Ç—É—Ä—ã, –ø—Ä–æ—à–µ–¥—à–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é
‚îî‚îÄ‚îÄ rejected_structures/       # –û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã + –ø—Ä–∏—á–∏–Ω–∞
```

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| üìÇ –ß—Ç–µ–Ω–∏–µ CIF | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö `.cif` —Ñ–∞–π–ª–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ |
| üî¨ –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –∞—Ç–æ–º–∞–º–∏ –∏ –æ–±—ä—ë–º–∞ –Ω–∞ –∞—Ç–æ–º |
| ‚öñÔ∏è –§–∏–∑–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∞—Ç–æ–º–æ–≤ –≤ —è—á–µ–π–∫–µ |
| ‚ö° –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ä—è–¥–∞ | –û—Ü–µ–Ω–∫–∞ charge neutrality –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö —Å—Ç–µ–ø–µ–Ω–µ–π –æ–∫–∏—Å–ª–µ–Ω–∏—è |
| üîÅ –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ | –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `StructureMatcher` |
| üÜï –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–∏–∑–Ω—ã | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å `train_reference.csv` –ø–æ —Ñ–æ—Ä–º—É–ª–µ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ |
| üß≤ –ú–∞–≥–Ω–∏—Ç–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã | –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã—Ö –º–µ—Ç–∞–ª–ª–æ–≤ –∏ —Ä–µ–¥–∫–æ–∑–µ–º–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ |
| üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `validation_report.json` –∏ `all_structures.csv` |
| üê≥ Docker-–ø–æ–¥–¥–µ—Ä–∂–∫–∞ | –ó–∞–ø—É—Å–∫ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ —á–µ—Ä–µ–∑ Docker |

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ß–µ—Ä–µ–∑ conda

```bash
conda env create -f environment.yml
conda activate mvpipeline
pip install -e .
```

### –ß–µ—Ä–µ–∑ Docker

```bash
bash scripts/run_docker.sh
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
mvp \
  --input-dir samples/mattergen_cifs \
  --out-dir outputs/mattergen \
  --train-reference train_reference.csv \
  --thresholds config/thresholds.yaml
```

### –ê—Ä–≥—É–º–µ–Ω—Ç—ã CLI

| –ê—Ä–≥—É–º–µ–Ω—Ç | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `--input-dir` | ‚úÖ | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ CIF-—Ñ–∞–π–ª–∞–º–∏ (–ø–æ–∏—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π) |
| `--out-dir` | ‚ùå | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `outputs/<model_name>`) |
| `--train-reference` | ‚ùå | –ü—É—Ç—å –∫ CSV —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ train-–Ω–∞–±–æ—Ä–∞ (–¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ `novelty_ratio`) |
| `--thresholds` | ‚ùå | –ü—É—Ç—å –∫ YAML-—Ñ–∞–π–ª—É —Å –ø–æ—Ä–æ–≥–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è) |
| `--model-name` | ‚ùå | –ò–º—è –º–æ–¥–µ–ª–∏ –¥–ª—è –æ—Ç—á—ë—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∏–º—è –ø–∞–ø–∫–∏ `input-dir`) |
| `--pretty / --no-pretty` | ‚ùå | –ö—Ä–∞—Å–∏–≤–æ –ø–µ—á–∞—Ç–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç –≤ –∫–æ–Ω—Å–æ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `--pretty`) |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –µ—Å–ª–∏ `--thresholds` –∏–ª–∏ `--train-reference` –Ω–µ —É–∫–∞–∑–∞–Ω—ã, pipeline –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º ‚Äî `novelty_ratio` –Ω–µ –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω, –∞ –ø–æ—Ä–æ–≥–∏ –±—É–¥—É—Ç –≤–∑—è—Ç—ã –∏–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤.

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –ø–æ—Ä–æ–≥–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ `config/thresholds.yaml`.

### –ì–µ–æ–º–µ—Ç—Ä–∏—è

```yaml
geometry:
  d_min_reject: 0.7       # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ < 0.7 √Ö ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (overlap)
  d_max_suspicious: 1.2   # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ 0.7‚Äì1.2 √Ö ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (suspicious)
  vol_min: 8.0            # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º –Ω–∞ –∞—Ç–æ–º (√Ö¬≥)
  vol_max: 40.0           # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º –Ω–∞ –∞—Ç–æ–º (√Ö¬≥)
```

### –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞

```yaml
physical_properties:
  min_density: 0.5        # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å (–≥/—Å–º¬≥)
  max_density: 30.0       # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å (–≥/—Å–º¬≥)
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```yaml
system_limits:
  max_n_atoms: 500        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –∞—Ç–æ–º–æ–≤ –≤ —è—á–µ–π–∫–µ
```

### –°—Ç–µ–ø–µ–Ω–∏ –æ–∫–∏—Å–ª–µ–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ charge neutrality. –ó–∞–¥–∞—é—Ç—Å—è —Å–ø–∏—Å–∫–æ–º –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å—Ç–µ–ø–µ–Ω–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞:

```yaml
oxidation_states:
  Fe: [2, 3]
  Ni: [2, 3]
  O:  [-2, -1]
  Ti: [2, 3, 4]
  # ... –∏ —Ç.–¥.
```

### –ú–∞–≥–Ω–∏—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –º–∞–≥–Ω–∏—Ç–Ω–∞—è (`is_magnetic = True`), –µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω—ã –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã 3d/4d/5d-—Ä—è–¥–æ–≤ –∏ –≤—Å–µ —Ä–µ–¥–∫–æ–∑–µ–º–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:

```yaml
magnetic_elements:
  # 3d –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã
  - Ti, V, Cr, Mn, Fe, Co, Ni, Cu, Zn
  # 4d/5d –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã
  - Mo, Ru, Rh, Pd, Re, Os, Ir
  # –†–µ–¥–∫–æ–∑–µ–º–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–ª–∞–Ω—Ç–∞–Ω–æ–∏–¥—ã)
  - Sc, Y, La, Ce, Pr, Nd, Pm, Sm, Eu, Gd, Tb, Dy, Ho, Er, Tm, Yb, Lu
```

---

## –§–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### train_reference.csv

CSV-—Ñ–∞–π–ª —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –∏–∑ –æ–±—É—á–∞—é—â–µ–≥–æ –Ω–∞–±–æ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–∏–∑–Ω—ã.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `id` | str | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| `reduced_formula` | str | –ü—Ä–∏–≤–µ–¥—ë–Ω–Ω–∞—è —Ö–∏–º–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Fe2O3`) |
| `spacegroup` | int/str | –ù–æ–º–µ—Ä –∏–ª–∏ —Å–∏–º–≤–æ–ª –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

–ü—Ä–∏–º–µ—Ä:

```csv
id,reduced_formula,spacegroup
mp-1234,Fe2O3,167
mp-5678,NiO,225
```

---

## –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### validation_report.json

```json
{
  "model_name": "mattergen",
  "n_total": 1000,
  "n_validated": 820,
  "n_rejected": 180,
  "validity_ratio": 0.82,
  "magnetic_ratio": 0.47,
  "novelty_ratio": 0.63,
  "duplicate_ratio": 0.12,
  "avg_density": 5.34,
  "avg_volume_per_atom": 13.2,
  "rejection_reasons": {
    "cif_parse_error": 10,
    "overlap": 95,
    "charge_imbalance": 50,
    "duplicate": 25
  }
}
```

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `n_total` | –°–∫–æ–ª—å–∫–æ CIF –Ω–∞–π–¥–µ–Ω–æ –≤ `input-dir` |
| `n_validated` | –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä –ø—Ä–æ—à–ª–æ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| `n_rejected` | –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ |
| `validity_ratio` | `n_validated / n_total` |
| `magnetic_ratio` | –î–æ–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä —Å –º–∞–≥–Ω–∏—Ç–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ |
| `novelty_ratio` | –î–æ–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, –Ω–µ —Å–æ–≤–ø–∞–≤—à–∏—Ö —Å train_reference |
| `duplicate_ratio` | –î–æ–ª—è —Ñ–∞–π–ª–æ–≤, –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã—Ö –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç—ã (–æ—Ç `n_total`) |
| `avg_density` | –°—Ä–µ–¥–Ω—è—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (–≥/—Å–º¬≥) |
| `avg_volume_per_atom` | –°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º –Ω–∞ –∞—Ç–æ–º –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (√Ö¬≥) |
| `rejection_reasons` | –°—á—ë—Ç—á–∏–∫ –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è |

### all_structures.csv

–ü–æ–ª–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –ø–æ –≤—Å–µ–º CIF –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `structure_id` | str | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ CIF –≤–Ω—É—Ç—Ä–∏ `input-dir` |
| `input_path` | str | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É CIF |
| `status` | str | `validated` –∏–ª–∏ `rejected` |
| `rejection_reason` | str/null | –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è |
| `is_suspicious` | bool | –§–ª–∞–≥ soft-–∞–Ω–æ–º–∞–ª–∏–∏ (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.7‚Äì1.2 √Ö) |
| `is_duplicate` | bool | –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º –¥—É–±–ª–∏–∫–∞—Ç–æ–º |
| `is_novel` | bool | –ù–æ–≤–∞—è –ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ train_reference |
| `is_magnetic` | bool | –°–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –º–∞–≥–Ω–∏—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã |
| `n_atoms` | int | –ß–∏—Å–ª–æ –∞—Ç–æ–º–æ–≤ –≤ —è—á–µ–π–∫–µ |
| `density` | float | –ü–ª–æ—Ç–Ω–æ—Å—Ç—å (–≥/—Å–º¬≥) |
| `volume_per_atom` | float | –û–±—ä—ë–º –Ω–∞ –∞—Ç–æ–º (√Ö¬≥) |
| `min_distance` | float | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –º–µ–∂–∞—Ç–æ–º–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (√Ö) |
| `reduced_formula` | str | –ü—Ä–∏–≤–µ–¥—ë–Ω–Ω–∞—è —Ö–∏–º–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞ |
| `spacegroup` | str/int/null | –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ |
| `charge_solution_json` | str/null | JSON —Å–æ —Å—Ç–µ–ø–µ–Ω—è–º–∏ –æ–∫–∏—Å–ª–µ–Ω–∏—è |
| `details_json` | str | –ü–æ–ª–Ω—ã–π JSON —Å –¥–µ—Ç–∞–ª—è–º–∏ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ |

### rejected_structures/

–†—è–¥–æ–º —Å –∫–∞–∂–¥—ã–º –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–º CIF —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `*.reason.json`:

```json
{
  "structure_id": "subdir/a.cif",
  "reason": "overlap",
  "details": {
    "min_distance": 0.42
  }
}
```

–ö–æ–¥—ã –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `cif_parse_error` | –§–∞–π–ª –Ω–µ –ø–æ–¥–¥–∞—ë—Ç—Å—è –ø–∞—Ä—Å–∏–Ω–≥—É |
| `overlap` | –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∞—Ç–æ–º–∞–º–∏ < `d_min_reject` (0.7 √Ö) |
| `charge_imbalance` | –ó–∞—Ä—è–¥ —ç–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–æ–π —è—á–µ–π–∫–∏ –Ω–µ –Ω–µ–π—Ç—Ä–∞–ª–µ–Ω |
| `duplicate` | –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –¥—É–±–ª–∏–∫–∞—Ç —É–∂–µ –ø—Ä–∏–Ω—è—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| `density_out_of_range` | –ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ `[min_density, max_density]` |
| `volume_out_of_range` | –û–±—ä—ë–º –Ω–∞ –∞—Ç–æ–º –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ `[vol_min, vol_max]` |
| `too_many_atoms` | –ß–∏—Å–ª–æ –∞—Ç–æ–º–æ–≤ –ø—Ä–µ–≤—ã—à–∞–µ—Ç `max_n_atoms` |

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω

```
–í—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å CIF-—Ñ–∞–π–ª–∞–º–∏
    ‚îÇ
    ‚ñº
1. –ü–æ–∏—Å–∫ CIF-—Ñ–∞–π–ª–æ–≤
   –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥ input-dir, —Å–±–æ—Ä –≤—Å–µ—Ö *.cif
    ‚îÇ
    ‚ñº
2. –ó–∞–≥—Ä—É–∑–∫–∞ train_reference
   –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ (formula, spacegroup) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–∏–∑–Ω—ã
    ‚îÇ
    ‚ñº
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ CIF:
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –ß—Ç–µ–Ω–∏–µ CIF (pymatgen)
    ‚îÇ         ‚îî‚îÄ –æ—à–∏–±–∫–∞ ‚Üí cif_parse_error ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ Sanity-–ø—Ä–æ–≤–µ—Ä–∫–∞
    ‚îÇ   –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –ø—É—Å—Ç–∞—è, —Ä–µ—à—ë—Ç–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    ‚îÇ   –ú–µ–∂–∞—Ç–æ–º–Ω—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è, –æ–±—ä—ë–º –Ω–∞ –∞—Ç–æ–º
    ‚îÇ         ‚îî‚îÄ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ < 0.7 √Ö ‚Üí overlap ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
    ‚îÇ         ‚îî‚îÄ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 0.7‚Äì1.2 √Ö ‚Üí suspicious (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
    ‚îÇ         ‚îî‚îÄ –æ–±—ä—ë–º –≤–Ω–µ [8.0, 40.0] √Ö¬≥ ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤
    ‚îÇ   –ü–ª–æ—Ç–Ω–æ—Å—Ç—å, —á–∏—Å–ª–æ –∞—Ç–æ–º–æ–≤
    ‚îÇ         ‚îî‚îÄ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–Ω–µ [0.5, 30.0] –≥/—Å–º¬≥ ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
    ‚îÇ         ‚îî‚îÄ —á–∏—Å–ª–æ –∞—Ç–æ–º–æ–≤ > 500 ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞—Ä—è–¥–∞
    ‚îÇ   –û—Ü–µ–Ω–∫–∞ —Å—Ç–µ–ø–µ–Ω–µ–π –æ–∫–∏—Å–ª–µ–Ω–∏—è –ø–æ —Ç–∞–±–ª–∏—Ü–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    ‚îÇ         ‚îî‚îÄ –∑–∞—Ä—è–¥ –Ω–µ –Ω—É–ª–µ–≤–æ–π ‚Üí charge_imbalance ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤
    ‚îÇ   –ü–ª–æ—Ç–Ω–æ—Å—Ç—å, –æ–±—ä—ë–º –Ω–∞ –∞—Ç–æ–º, —Ñ–æ—Ä–º—É–ª–∞, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞–≥–Ω–∏—Ç–Ω–æ—Å—Ç–∏
    ‚îÇ   –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ magnetic_elements
    ‚îÇ   (–º–µ—Ç—Ä–∏–∫–∞, –Ω–µ –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è)
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
    ‚îÇ   StructureMatcher —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —É–∂–µ –ø—Ä–∏–Ω—è—Ç—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏
    ‚îÇ         ‚îî‚îÄ —Å–æ–≤–ø–∞–ª–æ ‚Üí duplicate ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
    ‚îÇ
    ‚îî‚îÄ‚ñ∫ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–∏–∑–Ω—ã
        –°—Ä–∞–≤–Ω–µ–Ω–∏–µ (formula, spacegroup) —Å train_reference
        (–º–µ—Ç—Ä–∏–∫–∞, –Ω–µ –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è)
    ‚îÇ
    ‚ñº
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   –í–∞–ª–∏–¥–Ω—ã–µ     ‚Üí validated_structures/
   –û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ  ‚Üí rejected_structures/ + *.reason.json
    ‚îÇ
    ‚ñº
5. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
   all_structures.csv + validation_report.json
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–∏–∑–Ω—ã

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è **–Ω–µ –Ω–æ–≤–æ–π**, –µ—Å–ª–∏ –≤ `train_reference.csv` —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å —Å —Ç–æ–π –∂–µ –ø–∞—Ä–æ–π `(reduced_formula, spacegroup)`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –≤—ã—è–≤–∏—Ç—å, —à—Ç–∞–º–ø—É–µ—Ç –ª–∏ –º–æ–¥–µ–ª—å –æ—á–µ–≤–∏–¥–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è train-–Ω–∞–±–æ—Ä–∞. –ù–æ–≤–∏–∑–Ω–∞ ‚Äî **–º–µ—Ç—Ä–∏–∫–∞**, –∞ –Ω–µ –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.

### –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–î—É–±–ª–∏–∫–∞—Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ —á–µ—Ä–µ–∑ `pymatgen.analysis.structure_matcher.StructureMatcher`, –∞ –Ω–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º CIF. –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –±–∞–∫–µ—Ç–∞–º (—Ñ–æ—Ä–º—É–ª–∞ / —á–∏—Å–ª–æ –∞—Ç–æ–º–æ–≤ / spacegroup), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ –ø–æ–ø–∞—Ä–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| [pymatgen](https://pymatgen.org/) | –ß—Ç–µ–Ω–∏–µ CIF, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä, `StructureMatcher` |
| [spglib](https://spglib.readthedocs.io/) | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø —Å–∏–º–º–µ—Ç—Ä–∏–∏ |
| [typer](https://typer.tiangolo.com/) | CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| [pandas](https://pandas.pydata.org/) | –ß—Ç–µ–Ω–∏–µ `train_reference.csv`, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `all_structures.csv` |
| [numpy](https://numpy.org/) | –ß–∏—Å–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ |
| [tqdm](https://tqdm.github.io/) | –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç—ã—Å—è—á —Ñ–∞–π–ª–æ–≤ |
| [rich](https://rich.readthedocs.io/) | –ß–∏—Ç–∞–µ–º—ã–µ –ª–æ–≥–∏ –∏ –∏—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ |
| Docker | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞ |

---

## –°–∫—Ä–∏–ø—Ç—ã

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `scripts/run_validation.sh` | –ó–∞–ø—É—Å–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π –ø–æ–¥—Ä—è–¥ |
| `scripts/run_docker.sh` | –ó–∞–ø—É—Å–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ Docker |

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ `validation_report.json`:

```bash
# MatterGen
mvp --input-dir samples/mattergen --out-dir outputs/mattergen ...

# Con-CDVAE
mvp --input-dir samples/cdvae --out-dir outputs/cdvae ...

# CrystalFormer
mvp --input-dir samples/crystalformer --out-dir outputs/crystalformer ...
```

–ó–∞—Ç–µ–º —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å `validity_ratio`, `novelty_ratio`, `duplicate_ratio`, `avg_density` –∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –¥–ª—è –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).